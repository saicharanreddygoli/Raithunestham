<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ translate('Volunteer Support for Farmers', 'రైతుల కోసం సేవకుల సహాయం') }}</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6A9C42',
                        'primary-dark': '#4e7a31',
                        surface: '#F7F8F5',
                        'surface-dark': '#161a15',
                        accent: '#F9C74F'
                    },
                    fontFamily: {
                        display: ['Public Sans', 'Noto Sans Telugu', 'sans-serif']
                    }
                }
            }
        };
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="min-h-screen bg-surface font-display text-[#1f2715] dark:bg-surface-dark dark:text-gray-100">
    <div class="mx-auto flex min-h-screen w-full max-w-6xl flex-col px-4 pb-16">
        <header class="sticky top-0 z-30 -mx-4 mb-8 border-b border-primary/15 bg-surface/95 px-4 py-4 backdrop-blur dark:border-primary/30 dark:bg-surface-dark/85">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-3xl text-primary">volunteer_activism</span>
                    <div>
                        <p class="text-xs uppercase tracking-[0.35em] text-primary/80">{{ translate('Farmer Assistance', 'రైతుల సహాయం') }}</p>
                        <h1 class="text-lg font-semibold">{{ translate('Connect with a volunteer', 'సేవకునితో కలవండి') }}</h1>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <a href="{{ url_for('farmer') }}" class="inline-flex items-center gap-2 rounded-full border border-primary px-3 py-1.5 text-sm font-semibold text-primary transition hover:bg-primary/10 dark:border-primary/60 dark:text-primary">
                        <span class="material-symbols-outlined text-base">arrow_back</span>
                        <span>{{ translate('Back to dashboard', 'డ్యాష్‌బోర్డ్‌కు వెనుకకు') }}</span>
                    </a>
                    <a href="{{ url_for('logout') }}" class="inline-flex items-center gap-2 rounded-full border border-red-500 px-3 py-1.5 text-sm font-semibold text-red-500 transition hover:bg-red-500/10">
                        <span class="material-symbols-outlined text-base">logout</span>
                        <span>{{ translate('Logout', 'లాగ్ అవుట్') }}</span>
                    </a>
                </div>
            </div>
        </header>

        <main class="flex-1 space-y-8">
            <section class="grid gap-6 rounded-3xl bg-white p-6 shadow-sm shadow-primary/20 dark:bg-gray-900 lg:grid-cols-[1.4fr_1fr]">
                <div class="space-y-4">
                    <span class="inline-flex items-center gap-2 rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">{{ translate('Need guidance?', 'మార్గనిర్దేశనం కావాలా?') }}</span>
                    <h2 class="text-2xl font-semibold leading-snug">{{ translate('Volunteers can post tasks for you and coordinate workers by phone.', 'సేవకులు మీ కోసం పనులను పోస్ట్ చేసి, ఫోన్ ద్వారా కార్మికులను సమన్వయం చేస్తారు.') }}</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-300">{{ translate('Choose a volunteer you trust. They will call you to understand the work and update the platform on your behalf.', 'మీరు నమ్మే సేవకుడిని ఎంచుకోండి. వారు మీతో మాట్లాడి పనిని వివరంగా తెలుసుకొని, మీ తరఫున ప్లాట్‌ఫారమ్‌లో నవీకరిస్తారు.') }}</p>
                </div>
                <div class="rounded-2xl border border-primary/20 bg-primary/5 p-4 text-sm text-primary">
                    {% if farmer %}
                        <p class="font-semibold">{{ translate('Your details', 'మీ వివరాలు') }}</p>
                        <p class="mt-2 text-primary/80">{{ translate('Name', 'పేరు') }}: {{ farmer.name }}</p>
                        <p class="text-primary/80">{{ translate('Phone', 'ఫోన్') }}: {{ farmer.phone }}</p>
                        <p class="text-primary/80">{{ translate('Village', 'గ్రామం') }}: {{ farmer.village|capitalize }}</p>
                    {% else %}
                        <p class="font-semibold">{{ translate('Not logged in as farmer', 'రైతుగా లాగిన్ కాలేదు') }}</p>
                        <p class="mt-2 text-primary/80">{{ translate('You can still browse volunteers. Login to send a request.', 'మీరు సేవకులను చూడవచ్చు. అభ్యర్థన పంపడానికి లాగిన్ అవ్వండి.') }}</p>
                    {% endif %}
                </div>
            </section>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="space-y-3">
                        {% for category, message_text in messages %}
                            <div class="flex items-start gap-3 rounded-2xl border border-primary/20 bg-white/95 p-4 text-sm shadow-sm shadow-primary/15 dark:border-primary/40 dark:bg-gray-900">
                                <span class="material-symbols-outlined text-primary">info</span>
                                <div>
                                    <p class="font-semibold text-primary">{{ flash_labels.get(category, flash_default) }}</p>
                                    <p class="mt-1 text-gray-600 dark:text-gray-200">{{ message_text }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <section class="grid gap-6 lg:grid-cols-[1.1fr_0.9fr]">
                <article class="rounded-3xl bg-white p-6 shadow-sm shadow-primary/20 dark:bg-gray-900">
                    <h3 class="text-lg font-semibold text-[#1f2715] dark:text-gray-100">{{ translate('Send a help request', 'సహాయ అభ్యర్థన పంపండి') }}</h3>
                    <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">{{ translate('Pick the volunteer you want to work with. They will receive an alert with your phone number.', 'మీకు అనుకూలమైన సేవకుడిని ఎంచుకోండి. మీ ఫోన్ నంబర్‌తో వారికి సమాచారం పంపబడుతుంది.') }}</p>
                    <form method="POST" class="mt-4 grid gap-4">
                        <label class="grid gap-1 text-sm font-semibold text-gray-700 dark:text-gray-200">
                            <span>{{ translate('Volunteer', 'సేవకుడు') }}</span>
                            <select name="volunteer_id" class="rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary dark:bg-gray-800 dark:text-gray-100" {% if not volunteer_options %}disabled{% endif %}>
                                <option value="">{{ translate('Select a volunteer', 'ఒక సేవకుడిని ఎంచుకోండి') }}</option>
                                {% for vol in volunteer_options %}
                                    <option value="{{ vol.id }}">
                                        {{ vol.name }}{% if vol.village %} · {{ vol.village|capitalize }}{% endif %}{% if vol.phone %} ({{ vol.phone }}){% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if not volunteer_options %}
                                <span class="text-xs text-gray-500 dark:text-gray-400">{{ translate('No volunteers are available yet. Please try again soon.', 'ఇంకా సేవకులు అందుబాటులో లేరు. కొద్దిసేపటి తర్వాత మళ్లీ ప్రయత్నించండి.') }}</span>
                            {% endif %}
                        </label>
                        <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow hover:bg-primary-dark" {% if not volunteer_options or not farmer %}disabled{% endif %}>
                            <span class="material-symbols-outlined text-base text-white">send</span>
                            <span>{{ translate('Send request', 'అభ్యర్థన పంపండి') }}</span>
                        </button>
                        {% if not farmer %}
                            <p class="text-xs text-amber-600 dark:text-amber-300">{{ translate('Login as a farmer to submit a request.', 'అభ్యర్థనను సమర్పించడానికి రైతుగా లాగిన్ అవ్వండి.') }}</p>
                        {% endif %}
                    </form>
                </article>

                <aside class="space-y-4 rounded-3xl bg-white p-6 shadow-sm shadow-primary/20 dark:bg-gray-900">
                    <h3 class="text-lg font-semibold">{{ translate('How this works', 'ఇది ఎలా పనిచేస్తుంది') }}</h3>
                    <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                        <li class="flex items-start gap-2">
                            <span class="material-symbols-outlined text-primary">phone_in_talk</span>
                            <span>{{ translate('Volunteer calls you to note crop details, wages, and timings.', 'సేవకుడు పంట, వేతనం, సమయాలు వంటి వివరాలు తెలుసుకోవడానికి మీకు కాల్ చేస్తాడు.') }}</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="material-symbols-outlined text-primary">task_alt</span>
                            <span>{{ translate('They post or update the task so workers can see it quickly.', 'వారు పనిని పోస్ట్ చేసి లేదా నవీకరించి, కార్మికులు త్వరగా చూడేలా చేస్తారు.') }}</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="material-symbols-outlined text-primary">handshake</span>
                            <span>{{ translate('Volunteers also coordinate when workers accept your task.', 'కార్మికులు పనిని అంగీకరించినప్పుడు సేవకులు సమన్వయం చేస్తారు.') }}</span>
                        </li>
                    </ul>
                </aside>
            </section>

            <section class="space-y-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-[#1f2715] dark:text-gray-100">{{ translate('Volunteers by village', 'గ్రామాల వారీగా సేవకులు') }}</h3>
                    <span class="text-xs uppercase tracking-[0.35em] text-gray-500 dark:text-gray-500">{{ translate('Total volunteers', 'మొత్తం సేవకులు') }}: {{ volunteer_options|length }}</span>
                </div>
                <div class="grid gap-4 md:grid-cols-2">
                    {% for group in volunteer_groups %}
                        <article class="rounded-2xl border border-primary/15 bg-white p-5 shadow-sm dark:border-primary/40 dark:bg-gray-900">
                            <header class="mb-3 flex items-center justify-between">
                                <h4 class="text-lg font-semibold text-primary">{{ group.label|capitalize }}</h4>
                                <span class="text-xs uppercase tracking-[0.3em] text-gray-400">{{ translate('Village', 'గ్రామం') }}</span>
                            </header>
                            {% if group.volunteers %}
                                <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                                    {% for vol in group.volunteers %}
                                        <li class="rounded-xl border border-primary/10 bg-primary/5 p-3 dark:border-primary/30 dark:bg-primary/10">
                                            <p class="font-semibold text-primary">{{ vol.name }}</p>
                                            {% if vol.phone %}
                                                <p class="text-xs text-gray-500 dark:text-gray-300">{{ translate('Phone', 'ఫోన్') }}: {{ vol.phone }}</p>
                                                <a href="tel:{{ vol.phone }}" class="mt-2 inline-flex items-center gap-2 rounded-full border border-primary px-3 py-1 text-xs font-semibold text-primary transition hover:bg-primary/10 dark:border-primary/50 dark:text-primary">
                                                    <span class="material-symbols-outlined text-sm">call</span>
                                                    <span>{{ translate('Call volunteer', 'సేవకునికి కాల్ చేయండి') }}</span>
                                                </a>
                                            {% else %}
                                                <p class="text-xs text-gray-400">{{ translate('Phone not provided', 'ఫోన్ అందుబాటులో లేదు') }}</p>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-sm text-gray-400">{{ translate('No volunteer listed for this village yet.', 'ఈ గ్రామానికి ఇంకా సేవకుడు నమోదు కాలేదు.') }}</p>
                            {% endif %}
                        </article>
                    {% endfor %}
                </div>
            </section>
        </main>
    </div>

    <script src="/static/js/i18n.js"></script>
</body>
</html>
