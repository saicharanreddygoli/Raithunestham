<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ translate('Volunteer Support', 'సేవకుల సహాయం') }}</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#4CAF50',
                        'primary-dark': '#388E3C',
                        'surface': '#F7F8F6',
                        'surface-dark': '#1b1f1a',
                        accent: '#FFC107'
                    },
                    fontFamily: {
                        display: ['Public Sans', 'Noto Sans Telugu', 'sans-serif']
                    }
                }
            }
        };
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="min-h-screen bg-surface font-display text-[#1f261d] dark:bg-surface-dark dark:text-gray-100">
    <div class="mx-auto flex min-h-screen w-full max-w-6xl flex-col px-4 pb-16">
        <header class="sticky top-0 z-20 -mx-4 mb-8 border-b border-primary/10 bg-surface/95 px-4 py-4 backdrop-blur dark:border-primary/30 dark:bg-surface-dark/90">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined text-3xl text-primary">support_agent</span>
                    <div>
                        <p class="text-xs uppercase tracking-[0.35em] text-primary/70">{{ translate('Worker Support', 'కార్మికుల సహాయం') }}</p>
                        <h1 class="text-lg font-semibold">{{ translate('Volunteer directory', 'సేవకుల జాబితా') }}</h1>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <a href="{{ url_for('worker') }}" class="inline-flex items-center gap-2 rounded-full border border-primary px-3 py-1.5 text-sm font-semibold text-primary transition hover:bg-primary/10 dark:border-primary/60 dark:text-primary">
                        <span class="material-symbols-outlined text-base">arrow_back</span>
                        <span>{{ translate('Back to dashboard', 'డ్యాష్‌బోర్డ్కి వెనుకకు') }}</span>
                    </a>
                </div>
            </div>
        </header>

        <main class="flex-1 space-y-8">
            <section class="rounded-3xl bg-white p-6 shadow-sm shadow-primary/10 dark:bg-gray-900">
                <div class="grid gap-6 lg:grid-cols-[1.2fr_1fr]">
                    <div class="space-y-4">
                        <span class="inline-flex items-center gap-2 rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">{{ translate('Quick assistance', 'త్వరిత సహాయం') }}</span>
                        <h2 class="text-2xl font-semibold leading-tight">{{ translate('Volunteers can call you and explain the work clearly.', 'సేవకులు మీతో మాట్లాడి పనిని స్పష్టంగా వివరిస్తారు.') }}</h2>
                        <p class="text-sm text-gray-600 dark:text-gray-300">{{ translate('Share your contact details. We will alert volunteers who are closest to your village so they can reach out quickly.', 'మీ సంప్రదింపు వివరాలు పంచుకోవచ్చు. మీ గ్రామానికి సమీపంలో ఉన్న సేవకులకు మేము సమాచారాన్ని పంపుతాము.') }}</p>
                        {% if prefill_village %}
                            <p class="inline-flex items-center gap-2 rounded-xl bg-primary/10 px-3 py-2 text-xs font-semibold text-primary">
                                <span class="material-symbols-outlined text-sm">pin_drop</span>
                                {{ translate('Village pre-filled from the task you selected.', 'మీరు ఎంచుకున్న పనిపై ఆధారపడి గ్రామం ముందుగానే నమోదు చేయబడింది.') }}
                            </p>
                        {% endif %}
                    </div>
                    <div class="rounded-2xl border border-primary/20 bg-primary/5 p-4 text-sm text-primary">
                        <p class="font-semibold">{{ translate('Tip for faster help', 'త్వరిత సహాయం కోసం సూచన') }}</p>
                        <p class="mt-2 text-primary/80">{{ translate('Keep your phone nearby after submitting. Volunteers usually respond within a few minutes.', 'సమర్పణ తర్వాత మీ ఫోన్‌ను దగ్గరలో ఉంచండి. సేవకులు సాధారణంగా కొన్ని నిమిషాల్లో స్పందిస్తారు.') }}</p>
                    </div>
                </div>
            </section>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="space-y-3">
                        {% for category, message_text in messages %}
                            <div class="flex items-start gap-3 rounded-2xl border border-primary/20 bg-white/90 p-4 text-sm shadow-sm shadow-primary/10 dark:border-primary/40 dark:bg-gray-900">
                                <span class="material-symbols-outlined text-primary">info</span>
                                <div>
                                    <p class="font-semibold text-primary">{{ flash_labels.get(category, flash_default) if flash_labels else category|title }}</p>
                                    <p class="mt-1 text-gray-600 dark:text-gray-200">{{ message_text }}</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <section class="grid gap-6 lg:grid-cols-[1.1fr_0.9fr]">
                <article class="rounded-3xl bg-white p-6 shadow-sm shadow-primary/10 dark:bg-gray-900">
                    <form method="POST" class="grid gap-4">
                        <div class="grid gap-3 sm:grid-cols-2">
                            <label class="grid gap-1 text-sm font-semibold text-gray-700 dark:text-gray-200">
                                <span>{{ translate('Your name', 'మీ పేరు') }}</span>
                                <input type="text" name="worker_name" value="{{ (worker.name if worker else '') or '' }}" class="rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary dark:bg-gray-800 dark:text-gray-100" placeholder="{{ translate('Enter your name', 'మీ పేరును నమోదు చేయండి') }}" required>
                            </label>
                            <label class="grid gap-1 text-sm font-semibold text-gray-700 dark:text-gray-200">
                                <span>{{ translate('Phone number', 'ఫోన్ నంబర్') }}</span>
                                <input type="tel" name="worker_phone" value="{{ (worker.phone if worker else '') or '' }}" class="rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary dark:bg-gray-800 dark:text-gray-100" placeholder="{{ translate('Enter phone number', 'ఫోన్ నంబర్ నమోదు చేయండి') }}" required>
                            </label>
                        </div>
                        <label class="grid gap-1 text-sm font-semibold text-gray-700 dark:text-gray-200">
                            <span>{{ translate('Village', 'గ్రామం') }}</span>
                            <select name="worker_village" class="rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary dark:bg-gray-800 dark:text-gray-100">
                                <option value="">{{ translate('Select your village', 'మీ గ్రామాన్ని ఎంచుకోండి') }}</option>
                                {% for v in villages %}
                                    <option value="{{ v }}" {% if prefill_village and prefill_village == v.lower() %}selected{% endif %}>{{ v|capitalize }}</option>
                                {% endfor %}
                            </select>
                        </label>
                        <label class="grid gap-1 text-sm font-semibold text-gray-700 dark:text-gray-200">
                            <span>{{ translate('Choose a volunteer', 'ఒక సేవకుడిని ఎంచుకోండి') }}</span>
                            <select name="volunteer_id" class="rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary dark:bg-gray-800 dark:text-gray-100" {% if not volunteer_options %}disabled{% endif %}>
                                <option value="">{{ translate('Select a volunteer', 'ఒక సేవకుడిని ఎంచుకోండి') }}</option>
                                {% for vol in volunteer_options %}
                                    <option value="{{ vol.id }}">
                                        {{ vol.name }}{% if vol.village %} · {{ vol.village|capitalize }}{% endif %}{% if vol.phone %} ({{ vol.phone }}){% endif %}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if not volunteer_options %}
                                <span class="text-xs text-gray-500 dark:text-gray-400">{{ translate('No volunteers are available yet. Please try again soon.', 'ఇంకా సేవకులు నమోదు కాలేదు. కొద్దిసేపటి తర్వాత మళ్లీ ప్రయత్నించండి.') }}</span>
                            {% endif %}
                        </label>
                        <label class="grid gap-1 text-sm font-semibold text-gray-700 dark:text-gray-200">
                            <span>{{ translate('Additional notes (optional)', 'అదనపు గమనికలు (ఐచ్చికం)') }}</span>
                            <textarea name="worker_notes" rows="3" class="rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary dark:bg-gray-800 dark:text-gray-100" placeholder="{{ translate('Share anything that will help the volunteer understand your situation.', 'సేవకుడు మీ పరిస్థితిని అర్థం చేసుకోవడానికి సహాయపడే వివరాలను పంచుకోండి.') }}">{{ request.form.get('worker_notes', '') }}</textarea>
                        </label>
                        <input type="hidden" name="task_name" value="{{ prefill_task_name }}">
                        <input type="hidden" name="task_wage" value="{{ prefill_task_wage }}">
                        <input type="hidden" name="task_location" value="{{ prefill_task_location }}">
                        <input type="hidden" name="task_id" value="{{ prefill_task_id }}">
                        <button type="submit" class="inline-flex items-center justify-center gap-2 rounded-xl bg-primary px-4 py-2 text-sm font-semibold text-white shadow hover:bg-primary-dark" {% if not volunteer_options %}disabled{% endif %}>
                            <span class="material-symbols-outlined text-base text-white">send</span>
                            <span>{{ translate('Send help request', 'సహాయ అభ్యర్థన పంపండి') }}</span>
                        </button>
                    </form>
                </article>

                <aside class="space-y-4 rounded-3xl bg-white p-6 shadow-sm shadow-primary/10 dark:bg-gray-900">
                    <h3 class="text-lg font-semibold">{{ translate('Need automatic help?', 'స్వయంచాలక సహాయం కావాలా?') }}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300">{{ translate('When you tap “Ask Volunteer” on your dashboard, we now send your details to nearby volunteers automatically. Use this page only if you want to pick someone specific.', 'మీ డ్యాష్‌బోర్డ్‌లో “సేవక సహాయం కోరండి” అని నొక్కినప్పుడు, మీ వివరాలు స్వయంచాలకంగా సమీప సేవకులకు పంపబడతాయి. మీరు ఒక ప్రత్యేక సేవకుడిని ఎంచుకోవాలనుకుంటే ఈ పేజీని ఉపయోగించండి.') }}</p>
                    <div class="rounded-2xl border border-primary/20 bg-primary/5 p-4 text-sm">
                        <p class="font-semibold text-primary">{{ translate('Volunteer directory', 'సేవకుల నివేదిక') }}</p>
                        <p class="mt-2 text-primary/80">{{ translate('Scroll below to see who is available in each village and call them directly if needed.', 'ప్రతి గ్రామంలో అందుబాటులో ఉన్న సేవకులను క్రింద చూడండి మరియు అవసరమైతే నేరుగా కాల్ చేయండి.') }}</p>
                    </div>
                </aside>
            </section>

            <section class="space-y-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold">{{ translate('Volunteers by village', 'గ్రామాల వారీగా సేవకులు') }}</h3>
                    <span class="text-xs uppercase tracking-[0.35em] text-gray-500 dark:text-gray-500">{{ translate('Updated weekly', 'ప్రతి వారం నవీకరణ') }}</span>
                </div>
                <div class="grid gap-4 md:grid-cols-2">
                    {% for v in villages %}
                        <div class="rounded-2xl border border-primary/10 bg-white p-5 shadow-sm dark:border-primary/30 dark:bg-gray-900">
                            <header class="mb-3 flex items-center justify-between">
                                <h4 class="text-lg font-semibold text-primary">{{ v|capitalize }}</h4>
                                <span class="text-xs uppercase tracking-[0.3em] text-gray-400">{{ translate('Village', 'గ్రామం') }}</span>
                            </header>
                            {% set volunteer_list = volunteers_by_village.get(v) %}
                            {% if volunteer_list %}
                                <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                                    {% for vol in volunteer_list %}
                                        <li class="rounded-xl border border-primary/10 bg-primary/5 p-3 dark:border-primary/30 dark:bg-primary/10">
                                            <p class="font-semibold text-primary">{{ vol.name }}</p>
                                            {% if vol.phone %}
                                                <p class="text-xs text-gray-500 dark:text-gray-300">{{ translate('Phone', 'ఫోన్') }}: {{ vol.phone }}</p>
                                                <a href="tel:{{ vol.phone }}" class="mt-2 inline-flex items-center gap-2 rounded-full border border-primary px-3 py-1 text-xs font-semibold text-primary transition hover:bg-primary/10 dark:border-primary/50 dark:text-primary">
                                                    <span class="material-symbols-outlined text-sm">call</span>
                                                    <span>{{ translate('Call volunteer', 'సేవకునికి కాల్ చేయండి') }}</span>
                                                </a>
                                            {% else %}
                                                <p class="text-xs text-gray-400">{{ translate('Phone not provided', 'ఫోన్ అందుబాటులో లేదు') }}</p>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-sm text-gray-400">{{ translate('No volunteer listed for this village yet.', 'ఈ గ్రామానికి ఇంకా సేవకుడు నమోదు కాలేదు.') }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </section>
        </main>
    </div>

    <script src="/static/js/i18n.js"></script>
</body>
</html>
