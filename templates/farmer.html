<!DOCTYPE html>
<html class="light" lang="{{ lang }}">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>{{ labels.title }}</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#62d411",
                        "primary-dark": "#4c9f0d",
                        "background-light": "#f7f8f6",
                        "background-dark": "#182210",
                        "text-primary": "#131b0d",
                        "text-secondary": "#6c9a4c"
                    },
                    fontFamily: {
                        "display": ["Public Sans", "Noto Sans Telugu", "sans-serif"]
                    }
                }
            }
        };
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-primary dark:text-white">
    <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
        <header class="sticky top-0 z-20 flex items-center justify-between border-b border-gray-200 bg-background-light/95 px-4 py-3 backdrop-blur dark:border-gray-800 dark:bg-background-dark/90">
            <div class="flex items-center gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded-full bg-primary/20 text-primary">
                    <span class="material-symbols-outlined text-2xl">grass</span>
                </div>
                <div>
                    <p class="text-xs uppercase tracking-[0.3em] text-text-secondary dark:text-gray-400">{{ labels.header_welcome }}</p>
                    <h1 class="text-lg font-semibold leading-tight">{{ farmer.name }}</h1>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div class="hidden text-sm font-medium text-text-secondary dark:text-gray-300 sm:flex sm:flex-col sm:items-end">
                    <span>{{ farmer.village|capitalize }}</span>
                    <span>{{ farmer.phone }}</span>
                </div>
                <details class="relative [&_summary::-webkit-details-marker]:hidden">
                    <summary style="list-style: none;" class="relative flex h-10 w-10 cursor-pointer items-center justify-center rounded-full bg-primary/20 text-primary transition hover:bg-primary hover:text-white">
                        <span class="material-symbols-outlined text-lg">notifications</span>
                        {% set notification_count = notifications|length %}
                        {% if notification_count %}
                            <span class="absolute -top-1 -right-1 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-semibold text-white">{{ notification_count }}</span>
                        {% endif %}
                    </summary>
                    <div class="absolute right-0 mt-3 w-72 rounded-2xl border border-primary/20 bg-white p-4 text-sm shadow-lg shadow-primary/20 dark:border-primary/40 dark:bg-background-dark">
                        <div class="flex items-center justify-between gap-2">
                            <h3 class="text-sm font-semibold text-text-primary dark:text-white">{{ labels.notifications_title }}</h3>
                            <form method="POST" action="/farmer">
                                <input type="hidden" name="action" value="clear_notifications">
                                <button type="submit" class="inline-flex items-center gap-1 rounded-full border border-primary px-2 py-1 text-xs font-semibold text-primary transition hover:bg-primary hover:text-white">
                                    <span class="material-symbols-outlined text-sm">delete_sweep</span>
                                    {{ translate('Clear', 'తొలగించండి') }}
                                </button>
                            </form>
                        </div>
                        <div class="mt-3 max-h-64 space-y-3 overflow-y-auto">
                            {% if notifications %}
                                {% for notification in notifications %}
                                    <article class="rounded-xl border border-primary/15 bg-primary/5 p-3 text-text-primary dark:border-primary/30 dark:bg-white/10">
                                        <p class="text-sm font-semibold">{{ notification.message }}</p>
                                        <dl class="mt-2 space-y-1 text-xs text-text-secondary dark:text-gray-300">
                                            {% if notification.task_location %}
                                                <div class="flex justify-between gap-2">
                                                    <span>{{ labels.notification_location }}</span>
                                                    <span>{{ notification.task_location }}</span>
                                                </div>
                                            {% endif %}
                                            {% if notification.worker_phone %}
                                                <div class="flex justify-between gap-2">
                                                    <span>{{ labels.notification_worker_phone }}</span>
                                                    <span>{{ notification.worker_phone }}</span>
                                                </div>
                                            {% endif %}
                                            <div class="flex justify-between gap-2">
                                                <span>{{ labels.notification_when }}</span>
                                                <span>{{ notification.created_at | timestamp_to_datetime }}</span>
                                            </div>
                                        </dl>
                                    </article>
                                {% endfor %}
                            {% else %}
                                <p class="rounded-xl border border-dashed border-primary/30 bg-primary/5 p-4 text-center text-xs text-text-secondary">{{ labels.notifications_empty }}</p>
                            {% endif %}
                        </div>
                    </div>
                </details>
                <form action="/logout" method="get">
                    <button class="flex h-10 w-10 items-center justify-center rounded-full bg-primary/20 text-primary transition hover:bg-primary hover:text-white" type="submit" title="{{ labels.logout }}">
                        <span class="material-symbols-outlined">logout</span>
                    </button>
                </form>
            </div>
        </header>

        <main class="flex-1 pb-24">
            <section class="mx-auto flex w-full max-w-6xl flex-col gap-6 px-4 py-6">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message_text in messages %}
                            <div class="rounded-xl border border-primary/20 bg-white/80 p-4 text-sm text-text-primary shadow-md shadow-primary/10 dark:bg-white/5">
                                <div class="flex items-start gap-3">
                                    <span class="material-symbols-outlined text-primary">info</span>
                                    <div>
                                        <p class="font-semibold text-primary">{{ labels.flash_levels.get(category, labels.flash_default) }}</p>
                                        <p class="mt-1 text-text-primary dark:text-gray-200">{{ message_text }}</p>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                {% if message %}
                    <div class="rounded-xl border border-primary/20 bg-white/80 p-4 text-sm text-text-primary shadow-md shadow-primary/10 dark:bg-white/5">
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-primary">info</span>
                            <div>
                                <p class="font-semibold text-primary">{{ labels.flash_levels.get(message_type, labels.flash_default) }}</p>
                                <p class="mt-1 text-text-primary dark:text-gray-200">{{ message }}</p>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <div class="grid gap-6 lg:grid-cols-[1.4fr_1fr]">
                    <section class="space-y-4 rounded-2xl bg-white/90 p-5 shadow-lg shadow-primary/10 dark:bg-white/5">
                        <header class="flex flex-wrap items-center justify-between gap-3">
                            <div>
                                <p class="text-xs uppercase tracking-[0.35em] text-text-secondary/80">{{ labels.post_kicker }}</p>
                                <h2 class="text-2xl font-bold">{{ labels.post_title }}</h2>
                            </div>
                            <button id="toggleTaskForm" data-label-hide="{{ labels.post_hide_button }}" data-label-new="{{ labels.post_new_button }}" class="flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-background-dark shadow hover:bg-primary-dark dark:text-black" type="button">
                                <span class="material-symbols-outlined text-base">add_circle</span>
                                <span class="label">{{ labels.post_new_button }}</span>
                            </button>
                        </header>
                        <p class="text-sm text-text-secondary">
                            {{ labels.post_help_text }}
                        </p>
                        <form id="taskForm" method="POST" action="/farmer" class="grid gap-4 rounded-2xl border border-primary/15 bg-primary/5 p-4" style="display: none;">
                            <div class="grid gap-4 md:grid-cols-2">
                                <label class="space-y-2 text-sm font-medium text-text-primary">
                                    <span>{{ labels.form_mandal }}</span>
                                    <select class="w-full rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary" id="mandal" name="mandal" required>
                                        <option value="">{{ labels.form_select_mandal }}</option>
                                        <option value="gudlavalleru" selected>Gudlavalleru</option>
                                    </select>
                                </label>
                                <label class="space-y-2 text-sm font-medium text-text-primary">
                                    <span>{{ labels.form_village }}</span>
                                    <select class="w-full rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary" id="village" name="village" required>
                                        <option value="">{{ labels.form_select_village }}</option>
                                        {% for v in villages %}
                                            <option value="{{ v }}">{{ v|capitalize }}</option>
                                        {% endfor %}
                                    </select>
                                </label>
                            </div>
                            <div class="grid gap-4 md:grid-cols-2">
                                <label class="space-y-2 text-sm font-medium text-text-primary">
                                    <span>{{ labels.form_task }}</span>
                                    <select class="w-full rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary" id="task" name="task" required>
                                        <option value="">{{ labels.form_select_task }}</option>
                                        {% for task in tasks %}
                                            <option value="{{ task }}">{{ task }}</option>
                                        {% endfor %}
                                    </select>
                                </label>
                                <label class="space-y-2 text-sm font-medium text-text-primary">
                                    <span>{{ labels.form_num_workers }}</span>
                                    <input class="w-full rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary" id="num_workers" min="1" max="50" name="num_workers" type="number" value="1" required>
                                </label>
                            </div>
                            <div class="grid gap-4 md:grid-cols-2">
                                <label class="space-y-2 text-sm font-medium text-text-primary">
                                    <span>{{ labels.form_wage }}</span>
                                    <input class="w-full rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary" id="wage" min="0" name="wage" step="0.01" type="number">
                                </label>
                                <label class="space-y-2 text-sm font-medium text-text-primary">
                                    <span>{{ labels.form_description }}</span>
                                    <textarea class="w-full rounded-xl border border-primary/30 bg-white px-3 py-2 text-sm focus:border-primary focus:ring-primary" id="description" name="description" rows="3" placeholder="{{ labels.form_description_placeholder }}"></textarea>
                                </label>
                            </div>
                            <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                                <div class="text-xs text-text-secondary">
                                    {{ labels.form_help_hint }} <a class="font-semibold text-primary hover:underline" href="/farmer_help">{{ labels.link_request_help }}</a>
                                </div>
                                <button class="inline-flex items-center justify-center rounded-full bg-primary px-6 py-2 text-sm font-semibold text-background-dark shadow transition hover:bg-primary-dark dark:text-black" type="submit">
                                    <span class="material-symbols-outlined mr-1 text-base">send</span>
                                    <span>{{ labels.form_submit }}</span>
                                </button>
                            </div>
                        </form>
                    </section>

                    <aside class="space-y-4 rounded-2xl bg-white/90 p-5 shadow-lg shadow-primary/10 dark:bg-white/5">
                        <div>
                            <p class="text-xs uppercase tracking-[0.35em] text-text-secondary/80">{{ labels.summary_kicker }}</p>
                            <h2 class="text-xl font-semibold">{{ labels.summary_title }}</h2>
                        </div>
                        <dl class="grid gap-3 text-sm">
                            <div class="flex items-center justify-between rounded-xl bg-primary/10 px-4 py-3">
                                <dt class="font-medium text-text-secondary">{{ labels.summary_village }}</dt>
                                <dd class="font-semibold text-text-primary dark:text-white">{{ farmer.village|capitalize }}</dd>
                            </div>
                            <div class="flex items-center justify-between rounded-xl bg-primary/10 px-4 py-3">
                                <dt class="font-medium text-text-secondary">{{ labels.summary_phone }}</dt>
                                <dd class="font-semibold text-text-primary dark:text-white">{{ farmer.phone }}</dd>
                            </div>
                        </dl>
                        <div class="grid gap-3">
                            <a class="flex items-center justify-between rounded-xl border border-primary/20 px-3 py-2 text-sm font-semibold text-primary transition hover:bg-primary/10" href="/farmer_help">
                                <span class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-base">volunteer_activism</span>
                                    {{ labels.link_request_help }}
                                </span>
                                <span class="material-symbols-outlined text-sm">chevron_right</span>
                            </a>
                            <a class="flex items-center justify-between rounded-xl border border-primary/20 px-3 py-2 text-sm font-semibold text-primary transition hover:bg-primary/10" href="/worker_help">
                                <span class="flex items-center gap-2">
                                    <span class="material-symbols-outlined text-base">diversity_3</span>
                                    {{ labels.link_guide_worker }}
                                </span>
                                <span class="material-symbols-outlined text-sm">chevron_right</span>
                            </a>
                        </div>
                        {% if my_open_tasks %}
                            <div class="space-y-2">
                                <h3 class="text-sm font-semibold uppercase tracking-[0.3em] text-text-secondary/80">{{ labels.open_tasks }}</h3>
                                <ul class="space-y-2 text-sm">
                                    {% for t in my_open_tasks[:4] %}
                                        <li class="rounded-xl border border-primary/15 bg-primary/5 p-3">
                                            <p class="font-semibold text-text-primary dark:text-white">{{ t.task }}</p>
                                            <p class="text-xs text-text-secondary">{{ t.location }}</p>
                                            <p class="mt-1 text-xs text-text-secondary">
                                                {{ t.num_workers }} {{ labels.active_workers_label }} • ₹{{ t.wage }} {{ labels.wage_suffix }}<br>
                                                {{ t.created_at | timestamp_to_datetime }}
                                            </p>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </aside>
                </div>

                <section class="space-y-4 rounded-2xl bg-white/90 p-5 shadow-lg shadow-primary/10 dark:bg-white/5">
                    <header class="flex flex-wrap items-center justify-between gap-3">
                        <div>
                            <p class="text-xs uppercase tracking-[0.35em] text-text-secondary/80">{{ labels.active_kicker }}</p>
                            <h2 class="text-xl font-semibold">{{ labels.active_title }}</h2>
                        </div>
                    </header>
                    {% if my_open_tasks %}
                        <div class="grid gap-4 md:grid-cols-2">
                            {% for task in my_open_tasks %}
                                <article class="flex flex-col overflow-hidden rounded-2xl border border-primary/15 bg-white shadow-sm shadow-primary/5 transition hover:-translate-y-1 hover:shadow-lg dark:bg-white/5">
                                    <div class="space-y-4 p-5">
                                        <div class="flex items-start justify-between gap-3">
                                            <div>
                                                <h3 class="text-lg font-semibold text-text-primary dark:text-white">{{ task.task }}</h3>
                                                <p class="text-sm text-text-secondary">{{ task.location }}</p>
                                            </div>
                                            <div class="flex items-center gap-2">
                                                <span class="inline-flex items-center gap-1 rounded-full bg-primary/20 px-3 py-1 text-xs font-semibold text-primary">
                                                    <span class="inline-block h-2 w-2 rounded-full bg-primary"></span>
                                                    {{ status_labels.get(task.status or 'open', (task.status or 'open')|title) }}
                                                </span>
                                                <button type="button"
                                                        class="inline-flex items-center gap-1 rounded-full border border-red-500 px-3 py-1 text-xs font-semibold text-red-500 transition hover:bg-red-500 hover:text-white"
                                                        data-delete-task="true"
                                                        data-task-id="{{ task._id|string }}"
                                                        data-task-name="{{ task.task }}">
                                                    <span class="material-symbols-outlined text-sm">delete</span>
                                                    {{ translate('Delete', 'తొలగించండి') }}
                                                </button>
                                            </div>
                                        </div>
                                        <div class="space-y-3 text-sm text-text-secondary">
                                            <div class="flex items-center gap-3">
                                                <span class="material-symbols-outlined text-xl text-text-secondary">group</span>
                                                <span class="font-semibold text-text-primary dark:text-white">{{ task.accepted_workers|length }}/{{ task.num_workers }}</span>
                                                <span>{{ labels.active_workers_label }}</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <span class="material-symbols-outlined text-xl text-text-secondary">payments</span>
                                                <span class="font-semibold text-text-primary dark:text-white">₹{{ task.wage }} {{ labels.wage_suffix }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </article>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="rounded-xl border border-dashed border-primary/30 bg-primary/5 p-6 text-center text-sm text-text-secondary">
                            {{ labels.active_empty }}
                        </div>
                    {% endif %}
                </section>

                <section class="space-y-4 rounded-2xl bg-white/90 p-5 shadow-lg shadow-primary/10 dark:bg-white/5">
                    <header class="flex flex-wrap items-start justify-between gap-3">
                        <div>
                            <p class="text-xs uppercase tracking-[0.35em] text-text-secondary/80">{{ labels.help_kicker }}</p>
                            <h2 class="text-xl font-semibold">{{ labels.help_title }}</h2>
                            <p class="mt-2 text-sm text-text-secondary dark:text-gray-400">{{ labels.help_contact_hint }}</p>
                        </div>
                    </header>
                    {% if accepted_overview %}
                        <ul class="space-y-4">
                            {% for item in accepted_overview %}
                                <li class="rounded-2xl border border-primary/15 bg-primary/5 p-4">
                                    <div class="flex flex-wrap items-start justify-between gap-3">
                                        <div>
                                            <p class="text-lg font-semibold text-text-primary dark:text-white">{{ item.task }}</p>
                                            <p class="text-sm text-text-secondary">{{ item.location }}</p>
                                        </div>
                                        <div class="inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 text-xs font-semibold uppercase tracking-[0.2em] text-primary dark:bg-white/10">
                                            <span class="material-symbols-outlined text-sm text-primary">event_available</span>
                                            {{ status_labels.get(item.status or 'open', (item.status or 'open')|title) }}
                                        </div>
                                    </div>
                                    <div class="mt-3 grid gap-2 text-sm text-text-secondary dark:text-gray-400 sm:grid-cols-2">
                                        <div class="flex items-center gap-2">
                                            <span class="material-symbols-outlined text-primary">payments</span>
                                            <span>₹{{ item.wage or 0 }} {{ translate('per day', 'రోజుకు') }}</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="material-symbols-outlined text-primary">group</span>
                                            <span>{{ labels.help_workers_needed }} {{ item.num_workers }}</span>
                                        </div>
                                    </div>
                                    {% if item.volunteer_name %}
                                        <p class="mt-2 text-xs text-primary">{{ labels.help_volunteer }} <span class="font-semibold">{{ item.volunteer_name }}</span></p>
                                    {% endif %}
                                    <div class="mt-4 space-y-3">
                                        {% for assignment in item.assignments %}
                                            <article class="rounded-xl border border-primary/20 bg-white/80 p-3 text-sm text-text-primary shadow-sm dark:border-primary/30 dark:bg-white/10">
                                                <div class="flex flex-wrap items-start justify-between gap-3">
                                                    <div>
                                                        <p class="font-semibold text-primary">{{ assignment.name }}</p>
                                                        <p class="text-xs text-text-secondary">
                                                            {% if assignment.village %}{{ assignment.village|capitalize }} • {% endif %}
                                                            {% if assignment.phone %}{{ assignment.phone }}{% else %}{{ translate('Phone not available', 'ఫోన్ అందుబాటులో లేదు') }}{% endif %}
                                                        </p>
                                                    </div>
                                                    <div class="flex flex-wrap gap-2 text-xs">
                                                        {% if assignment.confirmed %}
                                                            <span class="inline-flex items-center gap-1 rounded-full bg-green-100 px-3 py-1 font-semibold text-green-700 dark:bg-green-900 dark:text-green-200">
                                                                <span class="material-symbols-outlined text-sm">verified</span>{{ translate('Confirmed', 'ధృవీకరించబడింది') }}
                                                            </span>
                                                        {% else %}
                                                            <form method="POST" action="/farmer">
                                                                <input type="hidden" name="form_type" value="assignment_update">
                                                                <input type="hidden" name="task_id" value="{{ item.task_id }}">
                                                                <input type="hidden" name="worker_id" value="{{ assignment.worker_id }}">
                                                                <input type="hidden" name="field" value="confirmed">
                                                                <button type="submit" class="inline-flex items-center gap-1 rounded-full border border-primary px-3 py-1 font-semibold text-primary transition hover:bg-primary hover:text-white">
                                                                    <span class="material-symbols-outlined text-sm">task_alt</span>{{ translate('Confirm worker', 'కార్మికుడిని ధృవీకరించండి') }}
                                                                </button>
                                                            </form>
                                                        {% endif %}
                                                        {% if assignment.arrived %}
                                                            <span class="inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 font-semibold text-blue-700 dark:bg-blue-900 dark:text-blue-200">
                                                                <span class="material-symbols-outlined text-sm">where_to_vote</span>{{ translate('Arrived', 'చేరారు') }}
                                                            </span>
                                                        {% else %}
                                                            <form method="POST" action="/farmer">
                                                                <input type="hidden" name="form_type" value="assignment_update">
                                                                <input type="hidden" name="task_id" value="{{ item.task_id }}">
                                                                <input type="hidden" name="worker_id" value="{{ assignment.worker_id }}">
                                                                <input type="hidden" name="field" value="arrived">
                                                                <button type="submit" class="inline-flex items-center gap-1 rounded-full border border-primary px-3 py-1 font-semibold text-primary transition hover:bg-primary hover:text-white">
                                                                    <span class="material-symbols-outlined text-sm">beenhere</span>{{ translate('Mark arrived', 'చేరినట్టు గుర్తించండి') }}
                                                                </button>
                                                            </form>
                                                        {% endif %}
                                                        {% if assignment.paid %}
                                                            <span class="inline-flex items-center gap-1 rounded-full bg-amber-100 px-3 py-1 font-semibold text-amber-700 dark:bg-amber-900 dark:text-amber-200">
                                                                <span class="material-symbols-outlined text-sm">currency_rupee</span>{{ translate('Paid', 'చెల్లింపు జరిగింది') }}
                                                            </span>
                                                        {% else %}
                                                            <form method="POST" action="/farmer">
                                                                <input type="hidden" name="form_type" value="assignment_update">
                                                                <input type="hidden" name="task_id" value="{{ item.task_id }}">
                                                                <input type="hidden" name="worker_id" value="{{ assignment.worker_id }}">
                                                                <input type="hidden" name="field" value="paid">
                                                                <button type="submit" class="inline-flex items-center gap-1 rounded-full border border-primary px-3 py-1 font-semibold text-primary transition hover:bg-primary hover:text-white">
                                                                    <span class="material-symbols-outlined text-sm">payments</span>{{ translate('Mark paid', 'చెల్లింపు నమోదుచేయండి') }}
                                                                </button>
                                                            </form>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="mt-3 flex flex-wrap items-center gap-3 text-xs text-text-secondary dark:text-gray-400">
                                                    {% if assignment.rating %}
                                                        <span class="inline-flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1 font-semibold text-primary">
                                                            <span class="material-symbols-outlined text-sm">grade</span>{{ translate('Rated', 'రేట్ చేయబడింది') }}: {{ assignment.rating }}/5
                                                        </span>
                                                    {% elif assignment.completed %}
                                                        <form method="POST" action="/farmer" class="flex items-center gap-2">
                                                            <input type="hidden" name="form_type" value="assignment_rating">
                                                            <input type="hidden" name="task_id" value="{{ item.task_id }}">
                                                            <input type="hidden" name="worker_id" value="{{ assignment.worker_id }}">
                                                            <label class="flex items-center gap-1 font-semibold text-text-secondary dark:text-gray-300">
                                                                <span class="material-symbols-outlined text-sm text-primary">star</span>{{ translate('Rate worker', 'కార్మికుడిని రేట్ చేయండి') }}
                                                            </label>
                                                            <select name="rating" class="rounded-full border border-primary/40 bg-white px-2 py-1 text-xs text-text-primary focus:border-primary focus:outline-none focus:ring-primary/30 dark:bg-gray-800 dark:text-gray-100">
                                                                {% for value in [1,2,3,4,5] %}
                                                                    <option value="{{ value }}">{{ value }}</option>
                                                                {% endfor %}
                                                            </select>
                                                            <button type="submit" class="rounded-full bg-primary px-3 py-1 font-semibold text-white hover:bg-primary-dark">{{ translate('Submit', 'సమర్పించు') }}</button>
                                                        </form>
                                                    {% else %}
                                                        <span>{{ translate('Waiting for completion before rating.', 'రేట్ చేయడానికి ముందు పూర్తి కావాలి.') }}</span>
                                                    {% endif %}
                                                </div>
                                            </article>
                                        {% endfor %}
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="rounded-xl border border-dashed border-primary/30 bg-primary/5 p-6 text-center text-sm text-text-secondary">
                            {{ labels.help_empty }}
                        </div>
                    {% endif %}
                </section>
            </section>
        </main>

        <!-- <footer class="fixed bottom-0 left-0 right-0 z-30 border-t border-gray-200 bg-background-light/95 backdrop-blur dark:border-gray-700 dark:bg-background-dark/90">
            <nav class="mx-auto flex w-full max-w-4xl justify-around px-6 py-2 text-xs font-medium uppercase tracking-[0.25em] text-text-secondary dark:text-gray-400">
                <a class="flex flex-col items-center gap-1 text-primary" href="#">
                    <span class="material-symbols-outlined text-2xl">home</span>
                    <span class="text-[10px]">{{ labels.footer_dashboard }}</span>
                </a>
                <a class="flex flex-col items-center gap-1 transition hover:text-primary" href="/farmer_help">
                    <span class="material-symbols-outlined text-2xl">chat_bubble</span>
                    <span class="text-[10px]">{{ labels.footer_messages }}</span>
                </a>
                <a class="flex flex-col items-center gap-1 transition hover:text-primary" href="/worker_help">
                    <span class="material-symbols-outlined text-2xl">groups</span>
                    <span class="text-[10px]">{{ labels.footer_workers }}</span>
                </a>
                <a class="flex flex-col items-center gap-1 transition hover:text-primary" href="/logout">
                    <span class="material-symbols-outlined text-2xl">person</span>
                    <span class="text-[10px]">{{ labels.footer_profile }}</span>
                </a>
            </nav>
        </footer> -->
    </div>

    <div id="deleteTaskModal" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/50 px-4">
        <div class="relative w-full max-w-md rounded-2xl bg-white p-6 text-text-primary shadow-xl shadow-primary/20 dark:bg-background-dark dark:text-white">
            <button type="button" class="absolute right-4 top-4 rounded-full border border-gray-200 p-1 text-gray-500 hover:bg-gray-100 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800" data-modal-close>
                <span class="material-symbols-outlined text-base">close</span>
            </button>
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-red-100 text-red-600 dark:bg-red-900/40 dark:text-red-300">
                <span class="material-symbols-outlined">delete</span>
            </div>
            <h3 class="mt-4 text-xl font-semibold">{{ translate('Delete this posting?', 'ఈ ప్రకటనను తొలగించాలా?') }}</h3>
            <p class="mt-2 text-sm text-text-secondary dark:text-gray-400">{{ translate('Workers will no longer see this task. This action cannot be undone.', 'ఈ పని ఇకపై కార్మికులకు కనిపించదు. ఈ చర్యను తిరస్కరించలేము.') }}</p>
            <p class="mt-3 rounded-xl bg-primary/10 px-3 py-2 text-sm font-semibold text-primary dark:bg-primary/20" id="deleteTaskName"></p>
            <form method="POST" action="/farmer" class="mt-6 flex flex-wrap items-center justify-end gap-3">
                <input type="hidden" name="form_type" value="delete_task">
                <input type="hidden" name="task_id" id="deleteTaskIdInput" value="">
                <button type="button" class="inline-flex items-center gap-2 rounded-full border border-gray-300 px-4 py-2 text-sm font-semibold text-gray-600 transition hover:bg-gray-100 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-800" data-modal-close>
                    <span class="material-symbols-outlined text-sm">close</span>
                    {{ translate('Cancel', 'రద్దు చేయి') }}
                </button>
                <button type="submit" class="inline-flex items-center gap-2 rounded-full bg-red-500 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-red-600">
                    <span class="material-symbols-outlined text-sm">delete_forever</span>
                    {{ translate('Delete posting', 'ప్రకటనను తొలగించండి') }}
                </button>
            </form>
        </div>
    </div>

    <script>
        (function() {
            const toggleButton = document.getElementById('toggleTaskForm');
            const taskForm = document.getElementById('taskForm');
            if (toggleButton && taskForm) {
                const labelSpan = toggleButton.querySelector('.label');
                const newLabel = toggleButton.dataset.labelNew;
                const hideLabel = toggleButton.dataset.labelHide;
                toggleButton.addEventListener('click', () => {
                    const isHidden = taskForm.style.display === 'none' || taskForm.style.display === '';
                    taskForm.style.display = isHidden ? 'grid' : 'none';
                    labelSpan.textContent = isHidden ? hideLabel : newLabel;
                });
            }

            const modal = document.getElementById('deleteTaskModal');
            if (!modal) return;
            const taskNameEl = document.getElementById('deleteTaskName');
            const taskIdInput = document.getElementById('deleteTaskIdInput');

            const openModal = (taskId, taskName) => {
                if (taskIdInput) taskIdInput.value = taskId || '';
                if (taskNameEl) taskNameEl.textContent = taskName || '';
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('overflow-hidden');
            };

            const closeModal = () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.classList.remove('overflow-hidden');
            };

            document.querySelectorAll('[data-delete-task="true"]').forEach((button) => {
                button.addEventListener('click', () => {
                    openModal(button.dataset.taskId, button.dataset.taskName);
                });
            });

            modal.querySelectorAll('[data-modal-close]').forEach((button) => {
                button.addEventListener('click', closeModal);
            });

            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });
        })();
    </script>
</body>
</html>
